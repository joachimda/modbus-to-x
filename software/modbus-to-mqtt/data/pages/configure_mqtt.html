<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Modbus To X - MQTT</title>
    <link rel="stylesheet" href="/assets/app.css" />
    <script type="importmap">
        {
          "imports": {
            "app": "/js/app.js",
            "configure_mqtt": "/js/pages/configure_mqtt.js"
          }
        }
    </script>
</head>
<body class="page font-sans" data-page="configure_mqtt">
<div class="mx-auto max-w-3xl px-4 pb-16">
    <header class="sticky top-0 z-20 -mx-4 mb-6 border-b border-slate-200 bg-white/90 px-4 py-6 shadow-sm backdrop-blur">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="space-y-1">
                <h1 class="text-2xl font-semibold tracking-tight text-slate-900">Configure MQTT</h1>
                <p class="muted text-sm">Set up connectivity to your MQTT broker and test the connection before saving.</p>
            </div>
            <nav class="flex flex-wrap items-center gap-2">
                <button class="icon-btn" type="button" onclick="window.location.href='/'" aria-label="Back to dashboard">
                    <svg class="h-5 w-5" viewBox="0 0 309.143 309.143" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M112.855,154.571L240.481,26.946c2.929-2.929,2.929-7.678,0-10.606L226.339,2.197
                 C224.933,0.79,223.025,0,221.036,0c-1.989,0-3.897,0.79-5.303,2.197L68.661,149.268
                 c-2.929,2.929-2.929,7.678,0,10.606l147.071,147.071c1.406,1.407,3.314,2.197,5.303,2.197
                 c1.989,0,3.897-0.79,5.303-2.197l14.142-14.143c2.929-2.929,2.929-7.678,0-10.606L112.855,154.571z" />
                    </svg>
                </button>
                <button class="icon-btn" type="button" id="btn-reload" aria-label="Reload MQTT config">
                    <svg class="h-5 w-5" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M440 0H328c-13.3 0-24 10.7-24 24s10.7 24 24 24h73.4L285.5 164.9c-69.7-53.1-169.4-46.2-232.6 17-69.2 69.2-69.2 181.5 0 250.7s181.5 69.2 250.7 0c63.2-63.2 70.1-162.9 17-232.6L464 110.6V184c0 13.3 10.7 24 24 24s24-10.7 24-24V72c0-39.8-32.2-72-72-72zM240 448c-66.3 0-120-53.7-120-120s53.7-120 120-120 120 53.7 120 120-53.7 120-120 120z" />
                    </svg>
                </button>
                <button class="btn btn-primary" type="button" id="btn-save">
                    <svg class="h-4 w-4" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                        <path d="M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z" />
                    </svg>
                    <span>Save &amp; Apply</span>
                </button>
            </nav>
        </div>
    </header>

    <main class="card space-y-6">
        <section class="space-y-4">
            <h2 class="section-title">Broker</h2>
            <div class="form-grid two">
                <label for="broker-ip">
                    <span>Broker IP</span>
                    <input id="broker-ip" type="text" placeholder="e.g. 192.168.1.100" />
                </label>
                <label for="broker-url">
                    <span>Broker URL</span>
                    <input id="broker-url" type="text" placeholder="e.g. mqtt://my.broker.local" />
                </label>
                <label for="broker-port">
                    <span>Port</span>
                    <input id="broker-port" type="number" min="1" max="65535" value="1883" />
                </label>
                <label for="broker-user">
                    <span>Username</span>
                    <input id="broker-user" type="text" placeholder="optional" />
                </label>
                <label for="broker-pass">
                    <span>Password</span>
                    <input id="broker-pass" type="password" placeholder="not stored in SPIFFS; leave blank to keep" />
                </label>
                <label for="root-topic">
                    <span>Root Topic</span>
                    <input id="root-topic" type="text" placeholder="e.g. mbx_root or home/mbx" />
                </label>
            </div>
            <p class="hint">When both IP and URL are provided, the IP is preferred. Passwords are stored separately in NVS and not exposed in SPIFFS.</p>
        </section>

        <div class="divider"></div>

        <section class="hstack flex-wrap gap-3">
            <button class="btn" id="btn-test" type="button">Test Connection</button>
            <span id="test-status" class="status-area"></span>
            <span class="spacer"></span>
            <span id="save-status" class="status-area"></span>
        </section>
    </main>
</div>

<script type="module">
    import 'app';
    import 'configure_mqtt';
</script>
</body>
</html>
