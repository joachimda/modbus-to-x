<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Modbus To X â€“ MQTT</title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="stylesheet" href="../style.css" />
    <script type="importmap">
        {
          "imports": {
            "app": "/js/app.js",
            "configure_mqtt": "/js/pages/configure_mqtt.js"
          }
        }
    </script>
    <style>
        .kvs input, .kvs select { height: 36px; }
    </style>
    </head>
<body class="configure" data-page="configure_mqtt">
<div class="page">
    <header style="display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;">
        <div>
            <h1>Configure MQTT</h1>
            <div class="muted">Configure a connection to an MQTT broker.</div>
        </div>
        <nav class="toolbar">
            <button class="iconButton backButton" onclick="window.location.href='/'" aria-label="Back to dashboard" title="Back to dashboard">
                <svg viewBox="0 0 309.143 309.143" xmlns="http://www.w3.org/2000/svg">
                    <path d="M112.855,154.571L240.481,26.946c2.929-2.929,2.929-7.678,0-10.606L226.339,2.197
                 C224.933,0.79,223.025,0,221.036,0c-1.989,0-3.897,0.79-5.303,2.197L68.661,149.268
                 c-2.929,2.929-2.929,7.678,0,10.606l147.071,147.071c1.406,1.407,3.314,2.197,5.303,2.197
                 c1.989,0,3.897-0.79,5.303-2.197l14.142-14.143c2.929-2.929,2.929-7.678,0-10.606L112.855,154.571z"
                          fill="currentColor" />
                </svg>
            </button>
            <button class="iconButton saveButton" id="btn-save" aria-label="Save and apply configuration" title="Save and apply configuration">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18.1716 1C18.702 1 19.2107 1.21071 19.5858 1.58579L22.4142 4.41421C22.7893 4.78929 23 5.29799 23 5.82843V20C23 21.6569 21.6569 23 20 23H4C2.34315 23 1 21.6569 1 20V4C1 2.34315 2.34315 1 4 1H18.1716ZM4 3C3.44772 3 3 3.44772 3 4V20C3 20.5523 3.44772 21 4 21L5 21L5 15C5 13.3431 6.34315 12 8 12L16 12C17.6569 12 19 13.3431 19 15V21H20C20.5523 21 21 20.5523 21 20V6.82843C21 6.29799 20.7893 5.78929 20.4142 5.41421L18.5858 3.58579C18.2107 3.21071 17.702 3 17.1716 3H17V5C17 6.65685 15.6569 8 14 8H10C8.34315 8 7 6.65685 7 5V3H4ZM17 21V15C17 14.4477 16.5523 14 16 14L8 14C7.44772 14 7 14.4477 7 15L7 21L17 21ZM9 3H15V5C15 5.55228 14.5523 6 14 6H10C9.44772 6 9 5.55228 9 5V3Z"
                          fill="currentColor"/>
                </svg>
            </button>
        </nav>
    </header>

    <main class="card">
        <h3>Broker</h3>
        <div class="kvs kvs-2">
            <div>Enable MQTT</div>
            <label class="switch" for="mqtt-enabled">
                <input id="mqtt-enabled" type="checkbox" />
                <span class="slider"></span>
            </label>

            <div>Broker IP</div>
            <label for="broker-ip"></label><input id="broker-ip" type="text" placeholder="e.g. 192.168.1.100" />

            <div>Broker URL</div>
            <label for="broker-url"></label><input id="broker-url" type="text" placeholder="e.g. mqtt://my.broker.local" />

            <div>Port</div>
            <label for="broker-port"></label><input id="broker-port" type="number" min="1" max="65535" value="1883" />

            <div>Username</div>
            <label for="broker-user"></label><input id="broker-user" type="text" placeholder="optional" />

            <div>Password</div>
            <div class="hstack">
                <label for="broker-pass"></label><input id="broker-pass" type="password" placeholder="not stored in SPIFFS; leave blank to keep" />
            </div>

            <div>Root Topic</div>
            <label for="root-topic"></label><input id="root-topic" type="text" placeholder="e.g. mbx_root or home/mbx" />
        </div>
        <div class="hint" style="margin-top:.75rem;">MQTT stays off until enabled. When both IP and URL are provided, the IP is preferred for connection. Password is saved separately in secure NVS storage.</div>
        <div class="divider"></div>
        <div class="hstack">
            <button class="btn" id="btn-test">Test Connection</button>
            <span id="test-status" class="muted"></span>
            <span style="flex:1 1 auto"></span>
            <span id="save-status" class="muted"></span>
        </div>
    </main>
</div>

<script type="module">
    import 'app';
    import 'configure_mqtt';
</script>
</body>
</html>
